
 <!-- eslint-disable-next-line svelte/no-navigation-without-resolve -->
<script lang="ts">
	import { onMount } from 'svelte';
	import { afterNavigate, goto } from '$app/navigation';
	import ToolCard from '$lib/components/ui/tool-card.svelte';
	import Button from '$lib/components/shadcn-svelte/ui/button/button.svelte';
	import { resolve } from '$app/paths';

	let { data } = $props();
	const tools = $derived(data.tools);

	function scrollToHash() {
		const hash = window.location.hash?.slice(1);
		if (!hash) return;
		const el = document.getElementById(hash);
		if (el) {
			el.scrollIntoView({ behavior: 'smooth', block: 'start' });
		}
	}

	onMount(() => {
		scrollToHash();
		window.addEventListener('hashchange', scrollToHash);
		return () => window.removeEventListener('hashchange', scrollToHash);
	});

	afterNavigate(() => {
		scrollToHash();
	});
</script>

<section class="flex flex-col px-6 py-4 text-center">
	<h1 class="mb-2">Tool overview</h1>
	<p class="subscript mb-4">
		Click a tool in the overview to jump to that project, or swipe down to scroll through them.
	</p>
	<div class="flex flex-col gap-y-2 text-start">
		{#each tools as tool, i (i)}
			<a
				class="grid grid-cols-2 hover:[&_.hover-target]:text-primary"
				href={`/tools#${tool.slug}`}
			>
				<div class="flex flex-col">
					<span class="hover-target font-bold">{tool.title}</span>
					<span class="subscript">{tool.shortDescription}</span>
				</div>
				<div class="aspect-video">
					<img
						src={`/tools/${tool.slug}/${tool.slug}${tool.hasGif ? '.gif' : '.png'}`}
						alt={`${tool.title} preview image`}
					/>
				</div>
			</a>
		{/each}
	</div>
</section>

{#each tools as tool, i (i)}
	<!-- Give each card a unique id based on its slug -->
	<section id={tool.slug} class="relative flex flex-col justify-center gap-y-8">
		<ToolCard {tool} />
		<div class="absolute bottom-8 w-full px-16">
			<div class="flex flex-row justify-between">
				{#if i !== 0}
					{@render button('prev', i)}
				{:else}
					{@render button('prev', i, true)}
				{/if}
				{#if i !== tools.length - 1}
					{@render button('next', i)}
				{:else}
					{@render button('next', i, true)}
				{/if}
			</div>
		</div>
	</section>
{/each}

{#snippet button(type: 'prev' | 'next', index: number, disabled: boolean = false)}
	<Button
		onclick={() => {
			const url = resolve(`/tools`) + `${tools[index + (type === 'prev' ? -1 : 1)].slug}`;
			goto(url);
			scrollToHash();
		}}
		class="flex min-w-24 flex-col text-center"
		variant="ghost"
		disabled={index == 0 ? false : disabled}
	>
		{#if index === 0}
			<span>{`${type === 'prev' ? 'Overview' : 'Next'}`}</span>
		{:else}
			<span>{`${type === 'prev' ? 'Previous' : 'Next'}`}</span>
		{/if}
	</Button>
{/snippet}
